
<app-header-toolbar titulo="Contact"></app-header-toolbar>

<ion-content class="ion-padding" [fullscreen]="true">
	<ng-template [ngIf]="ready" [ngIfElse]="loading">
		<ion-grid>
			<ion-row>
				<ion-col size="7" id="contact">
					<ion-card>
						<ion-card-content>
							<div>
								<!-- TBD: ability to upload avatar img -->
								<ion-avatar slot="start">
									<img src="../../../assets/avatar.svg">
								</ion-avatar>
								<ion-buttons>
									<ion-button color="primary" (click)="edit()">
										<ion-icon name="create-outline"></ion-icon>
									</ion-button>
									<ion-button color="danger" (click)="archive()">
										<ion-icon name="archive-outline"></ion-icon>
									</ion-button>
								</ion-buttons>
							</div>
							<h1><b>{{ contact.name | uppercase }}</b></h1>
							<h3>
								{{ contactType ?? "" | titlecase }}
								<span *ngIf="(contact.caat ?? '') != ''"> - {{ contact.caat }}</span>
							</h3>
							<ion-list lines="none">
								<ion-item>
									<ion-icon name="location-outline" slot="start" size="large"></ion-icon>
									<ion-label>
										<ng-template [ngIf]="(contact.streetAddress ?? '') != '' || (contact.city ?? '') != '' 
											|| (contact.state ?? '') != '' || (contact.zipCode ?? '') != ''"
											[ngIfElse]="noEntry"
										>
											<span *ngIf="(contact.streetAddress ?? '') != ''">{{ contact.streetAddress | titlecase }}
											<br>
											</span>
											<span *ngIf="(contact.city ?? '') != ''">{{ contact.city | titlecase }}</span>
											<span *ngIf="(contact.state ?? '') != ''">, {{ contact.state | titlecase | stateAbbreviation }}</span>
											<span *ngIf="(contact.zipCode ?? '') != ''">, {{ contact.zipCode }}</span>
										</ng-template>
									</ion-label>
								</ion-item>
							</ion-list>
						</ion-card-content>
					</ion-card>
				</ion-col>
				<ion-col id="primary-metacontact">
					<ion-card>
						<ion-card-header><h2>Primary Contact:</h2></ion-card-header>
					</ion-card>
					<ion-card>
						<ion-card-content>
							<ion-avatar>
								<img src="../../../assets/avatar.svg">
							</ion-avatar>
							<h2><span *ngIf="(primaryContact.name ?? '') !== '' else noEntry">{{ primaryContact.name | titlecase }}</span></h2>
							<ion-list lines="none">
								<ion-item>
									<ion-icon name="call-outline" slot="start"></ion-icon>
									<ion-label>
										<span *ngIf="(primaryContact.phone ?? '') !== '' else noEntry">{{ primaryContact.phone }}</span>
									</ion-label>
								</ion-item>
								<ion-item>
									<ion-icon name="mail-outline" slot="start"></ion-icon>
									<ion-label>
										<span *ngIf="(primaryContact.email ?? '') !== '' else noEntry">{{ primaryContact.email | lowercase }}</span>
									</ion-label>
								</ion-item>
							</ion-list>
						</ion-card-content>
					</ion-card>
				</ion-col>
			</ion-row>
			
			<ion-row>
				<ion-col id="metacontacts">
					<ion-card *ngFor="let metacontact of contact.metacontacts.filter(standardMetacontact)">
						<ion-card-content>
							<ion-avatar>
								<img src="../../../assets/avatar.svg">
							</ion-avatar>
							<div>
								<h2>
									<span *ngIf="(metacontact.name ?? '') !== '' else noEntry">{{ metacontact.name | titlecase}}</span>
								</h2>
								<div>
									<span *ngIf="(metacontact.phone ?? '') !== '' else noEntry">{{ metacontact.phone }}</span>
								</div>
								<div>
									<span *ngIf="(metacontact.email ?? '') !== '' else noEntry">{{ metacontact.email | lowercase }}</span>
								</div>
							</div>
						</ion-card-content>
					</ion-card>
				</ion-col>
			</ion-row>

			<h4><span>Analytics</span></h4>
			<ion-row>
				<ion-col>
					<ion-card>
						analytics information 1
						<div>--</div>
						<div>--</div>
						<div>--</div>
						<div>--</div>
					</ion-card>
				</ion-col>
				<ion-col>
					<ion-card>
						analytics information 2
						<div>--</div>
						<div>--</div>
						<div>--</div>
						<div>--</div>
					</ion-card>
				</ion-col>
				<ion-col>
					<ion-card>
						analytics information 3
						<div>--</div>
						<div>--</div>
						<div>--</div>
						<div>--</div>
					</ion-card>
				</ion-col>
			</ion-row>
		
			<ng-template [ngIf]="docCount() > 0">
				<h4><span>{{ contactType === 'client' ? 'Contracts' : 'Tickets' }}</span></h4>
				<ng-template [ngIf]="contactType === 'client'" [ngIfElse]="tickets">
					<ion-row>
						<ion-segment [value]="getContractType()" (ionChange)="changeContracts($event)">
							<ion-segment-button value="purchase" *ngIf="docCount(true) > 0">
								<ion-label>Purchase Contracts</ion-label>
							</ion-segment-button>
							<ion-segment-button value="sales" *ngIf="docCount(false) > 0">
								<ion-label>Sales Contracts</ion-label>
							</ion-segment-button>
						</ion-segment>
					</ion-row>
					<ion-row>
						<ion-col>
							<ion-card>
								<div class="table-row contracts">
									<span>ID</span>
									<span>Date</span>
									<span>Status</span>
									<span>Product</span>
									<span>Quantity</span>
									<span>Price</span>
									<span>Total</span>
								</div>
								<div class="table-row contracts" [class.odd]="odd"
									*ngFor="let doc of (contractType === 'purchase' ? primaryPagination : secondaryPagination)?.list; let odd = odd"
									(click)="openContract(doc.ref.id)"
								>
									<span>{{ doc.id }}</span>
									<span>{{ doc.date | date }}</span>
									<span><span class="status" [ngClass]="doc.status.toLocaleLowerCase()">{{ doc.status }}</span></span>
									<span>{{ doc.product.id }}</span>
									<span>{{ doc.quantity | number }}</span>
									<span>{{ doc.pricePerBushel | currency: '$' }}</span>
									<span>{{ doc.quantity / doc.productInfo.weight * doc.pricePerBushel | currency }}</span>
								</div>
							</ion-card>
						</ion-col>
					</ion-row>
				</ng-template>
				<ng-template #tickets>
					<ion-row>
						<ion-col>
							<ion-card>
								<div class="table-row">
									<span>ID</span>
									<span>Date</span>
									<span>Contract</span>
									<span>Product</span>
									<span>Gross ( lbs. )</span>
									<span>Tare ( lbs. )</span>
									<span>Net ( lbs. )</span>
									<span>--</span>
								</div>
								<div class="table-row" [class.odd]="odd" *ngFor="let doc of primaryPagination?.list; let odd = odd">
									<span>{{ doc.id }}</span>
									<span>{{ doc.dateOut | date }}</span>
									<span>{{ doc.contractID }}</span>
									<span>{{ doc.productName }}</span>
									<span>{{ doc.gross | number }}</span>
									<span>{{ doc.tare | number }}</span>
									<span>{{ doc.getNet() | number }}</span>
									<span>--</span>
								</div>
							</ion-card>
						</ion-col>
					</ion-row>
				</ng-template>
			</ng-template>
		</ion-grid>
		<ion-infinite-scroll threshold="200px" (ionInfinite)="infiniteContracts($event)">
			<ion-infinite-scroll-content
				loadingSpinner="bubbles"
				loadingText="Loading more data...">
			</ion-infinite-scroll-content>
		</ion-infinite-scroll>
	</ng-template>
</ion-content>

<!-- templates -->

<ng-template #loading>
	<div>
		<mat-spinner></mat-spinner>
	</div>
</ng-template>

<ng-template #noEntry>
	<i>N/A</i>
</ng-template>
