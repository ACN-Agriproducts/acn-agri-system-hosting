
<h2 mat-dialog-title>Set Invoice Items</h2>

<mat-dialog-content>
	<mat-grid-list cols="10" rowHeight="70px" gutterSize="5px">
		<mat-grid-tile colspan="8">
			<ng-template [ngIf]="!settingName" [ngIfElse]="setName">
				<mat-form-field appearance="fill">
					<mat-label>Item</mat-label>
					<input 
						matInput
						(ngModelChange)="applyFilter($event)"
						[(ngModel)]="currentItem"
						[matAutocomplete]="auto"
					>
					<mat-autocomplete 
						#auto="matAutocomplete"
						(optionSelected)="displayInvoiceItem($event)"
						[displayWith]="displayFn"
					>
						<mat-option (click)="addItem()" [value]="createItem()">
							<span class="add-option">
								Add Item &nbsp; <mat-icon>add_box</mat-icon>
							</span>
						</mat-option>
						<mat-option *ngFor="let option of filteredOptions" [value]="option">
							{{ option.name }}
						</mat-option>
					</mat-autocomplete>
					<span matSuffix class="name-icons">
						<button 
							mat-icon-button 
							*ngIf="currentItem.name.trim() !== '' && !settingName" 
							(click)="reset()"
						>
							<mat-icon>close</mat-icon>
						</button>
						<mat-icon matSuffix>arrow_drop_down</mat-icon>
					</span>
				</mat-form-field>
			</ng-template>

			<ng-template #setName>
				<mat-form-field appearance="fill">
					<mat-label>Name</mat-label>
					<input 
						matInput 
						#name="ngModel" 
						(blur)="toggleSetName()" 
						[(ngModel)]="currentItem.name"
						required
					>
					<mat-error>Name is <strong>required</strong></mat-error>
				</mat-form-field>
			</ng-template>
		</mat-grid-tile>

		<mat-grid-tile colspan="2">
			<ion-button 
				(click)="settingName = !settingName" 
				[color]="settingName ? 'danger': 'primary'" 
				[disabled]="currentItem == null || currentItem.name === ''"
				[matTooltip]="settingName ? 'Stop Editing' : 'Edit Name'"
				matTooltipClass="tooltip-primary-solid" 
				matTooltipPosition="right" 
				matTooltipShowDelay="1000"
			>
				<ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
			</ion-button>
		</mat-grid-tile>

		<mat-grid-tile colspan="5">
			<mat-form-field appearance="fill">
				<mat-label>Price</mat-label>
				<span matPrefix>$ &nbsp;</span>
				<input matInput [(ngModel)]="currentItem.price" type="number">
			</mat-form-field>
		</mat-grid-tile>

		<mat-grid-tile colspan="5">
			<mat-checkbox color="primary" [(ngModel)]="currentItem.affectsInventory">Affects Inventory</mat-checkbox>
		</mat-grid-tile>
	</mat-grid-list>

	<ng-template [ngIf]="currentItem.affectsInventory">
		<div class="info-header">
			Inventory Info
			<button mat-icon-button 
				(click)="currentItem.inventoryInfo.info.unshift(createInfo())"
				matTooltip="Add Inventory Info"
				matTooltipClass="tooltip-primary-solid" 
				matTooltipPosition="right" 
				matTooltipShowDelay="1000"
			>
				<mat-icon>add_box</mat-icon>
			</button>
		</div>

		<div class="inventory-info">
			<div *ngFor="let item of currentItem.inventoryInfo.info; let index = index">
				<mat-divider *ngIf="index !== 0"></mat-divider>

				<div class="info">
					<mat-grid-list cols="10" gutterSize="20px" rowHeight="75px">
						<mat-grid-tile colspan="6">
							<mat-form-field appearance="fill">
								<mat-label>Product</mat-label>
								<mat-select 
									[(ngModel)]="currentItem.inventoryInfo.info[index].product" 
									[disableOptionCentering]="true" 
									required
								>
									<mat-option *ngFor="let product of productList" [value]="product">{{ product }}</mat-option>
								</mat-select>
								<mat-error>Product is <strong>required</strong></mat-error>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile colspan="3">
							<mat-form-field appearance="fill">
								<mat-label>Quantity</mat-label>
								<input matInput [(ngModel)]="currentItem.inventoryInfo.info[index].quantity" required/>
								<span matSuffix>lbs</span>
								<mat-error>Quantity is <strong>required</strong></mat-error>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile>
							<button mat-icon-button 
								color="warn" 
								class="delete"
								(click)="deleteItem(index)" 
								matTooltip="Delete Inventory Info"
								matTooltipClass="tooltip-primary-solid" 
								matTooltipPosition="right" 
								matTooltipShowDelay="1000"
							>
								<mat-icon>delete</mat-icon>
							</button>
						</mat-grid-tile>
					</mat-grid-list>

					<mat-grid-list cols="10" gutterSize="20px" rowHeight="75px">
						<mat-grid-tile colspan="5">
							<mat-form-field appearance="fill">
								<mat-label>Plant</mat-label>
								<mat-select #plant 
									[(ngModel)]="currentItem.inventoryInfo.info[index].plant"
									[disableOptionCentering]="true" 
									required
								>
									<mat-option *ngFor="let plant of plantList" [value]="plant">{{ plant }}</mat-option>
								</mat-select>
								<mat-error>Plant is <strong>required</strong></mat-error>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile colspan="4">
							<mat-form-field appearance="fill">
								<mat-label>Tank</mat-label>
								<mat-select 
									[(ngModel)]="currentItem.inventoryInfo.info[index].tank"
									[disabled]="plant.value == ''" 
									[disableOptionCentering]="true" 
									required
								>
									<mat-option *ngFor="let tank of getTankList(index)" [value]="tank">{{ tank }}</mat-option>
								</mat-select>
								<mat-error>Tank is <strong>required</strong></mat-error>
							</mat-form-field>
						</mat-grid-tile>
					</mat-grid-list>
				</div>
			</div>
		</div>
	</ng-template>
</mat-dialog-content>

<mat-dialog-actions>
	<button mat-button color="primary" [mat-dialog-close]="null">Cancel</button>
	<button mat-button color="primary" [mat-dialog-close]="null" [disabled]="true">Confirm</button>
</mat-dialog-actions>
