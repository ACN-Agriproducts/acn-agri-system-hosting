
<h2 mat-dialog-title>Set Invoice Items</h2>

<mat-dialog-content>
	<mat-grid-list cols="10" rowHeight="70px">
		<mat-grid-tile colspan="8">
			<mat-form-field appearance="fill">
				<mat-label>Name</mat-label>
				<ng-container *ngIf="!settingName else setName">
					<input matInput [(ngModel)]="currentItem" [matAutocomplete]="auto" (ngModelChange)="applyFilter($event)">
					<mat-autocomplete #auto="matAutocomplete" (optionSelected)="displayInvoiceItem($event)" [displayWith]="displayFn">
						<mat-option (click)="setNew()" [value]="defaultItem()">
							<span class="add-option">
								Add Item
								&nbsp;
								<mat-icon>add_box</mat-icon>
							</span>
						</mat-option>
						<mat-option *ngFor="let option of filteredOptions" [value]="option">
							{{ option.name }}
						</mat-option>
					</mat-autocomplete>
				</ng-container>
				<ng-template #setName>
					<input matInput [(ngModel)]="currentItem.name" (ngModelChange)="applyFilter($event)" (blur)="settingName = false">
				</ng-template>
				<span matSuffix class="name-icons">
					<button mat-icon-button *ngIf="currentItem.name !== ''" (click)="reset()">
						<mat-icon>close</mat-icon>
					</button>
					<mat-icon matSuffix>arrow_drop_down</mat-icon>
				</span>
			</mat-form-field>
		</mat-grid-tile>

		<mat-grid-tile colspan="2">
			<ion-button (click)="settingName = !settingName" [color]="settingName ? 'danger': 'primary'" [disabled]="currentItem == null">
				<ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
			</ion-button>
		</mat-grid-tile>

		<mat-grid-tile colspan="5">
			<mat-form-field appearance="fill">
				<mat-label>Price</mat-label>
				<span matPrefix>$ &nbsp;</span>
				<input matInput [(ngModel)]="currentItem.price" type="number">
			</mat-form-field>
		</mat-grid-tile>

		<mat-grid-tile colspan="5">
			<mat-checkbox color="primary" [(ngModel)]="currentItem.affectsInventory">Affects Inventory</mat-checkbox>
		</mat-grid-tile>
	</mat-grid-list>

	<ng-template [ngIf]="currentItem.affectsInventory">
		<div class="info-header">
			<h3>Inventory Info.</h3>
		</div>
		<div class="inventory-info">
			<div>
				<div class="info-grid" *ngFor="let item of currentItem.inventoryInfo.info; let index = index">
					<mat-grid-list cols="5" gutterSize="20px" rowHeight="75px">
						<mat-grid-tile colspan="3">
							<mat-form-field appearance="fill">
								<mat-label>Product</mat-label>
								<mat-select [disableOptionCentering]="true" [(ngModel)]="currentItem.inventoryInfo.info[index].product">
									<mat-option *ngFor="let product of productList" [value]="product">{{ product }}</mat-option>
								</mat-select>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile colspan="2">
							<mat-form-field appearance="fill">
								<mat-label>Quantity</mat-label>
								<input matInput [(ngModel)]="currentItem.inventoryInfo.info[index].quantity"/>
								<span matSuffix>lbs</span>
							</mat-form-field>
						</mat-grid-tile>
					</mat-grid-list>

					<mat-grid-list cols="5" gutterSize="20px" rowHeight="75px">
						<mat-grid-tile colspan="3">
							<mat-form-field appearance="fill">
								<mat-label>Plant</mat-label>
								<mat-select [disableOptionCentering]="true" [(ngModel)]="currentItem.inventoryInfo.info[index].plant">
									<mat-option *ngFor="let plant of plantList" [value]="plant">{{ plant }}</mat-option>
								</mat-select>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile colspan="2">
							<mat-form-field appearance="fill">
								<mat-label>Tank</mat-label>
								<input matInput [(ngModel)]="currentItem.inventoryInfo.info[index].tank"/>
							</mat-form-field>
						</mat-grid-tile>
					</mat-grid-list>
		
					<mat-divider *ngIf="index !== currentItem.inventoryInfo.info.length - 1"></mat-divider>
				</div>
			</div>
		</div>
	</ng-template>
</mat-dialog-content>

<mat-dialog-actions>
	<button mat-button color="primary" [mat-dialog-close]="null">Cancel</button>
	<button mat-button color="primary" [mat-dialog-close]="null" >Confirm</button>
</mat-dialog-actions>
