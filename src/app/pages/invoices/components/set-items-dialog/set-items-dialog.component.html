
<h2 mat-dialog-title>Set Invoice Items</h2>

<mat-dialog-content>
	<form [formGroup]="invoiceItemForm">
		<mat-grid-list cols="7" rowHeight="70px">
			<mat-grid-tile colspan="7">
				<mat-form-field appearance="fill">
					<mat-label>Name</mat-label>
					<input matInput formControlName="name" [matAutocomplete]="auto">
					<mat-icon matSuffix>
						arrow_drop_down
					</mat-icon>
					<mat-autocomplete #auto="matAutocomplete" (optionSelected)="displayInvoiceItem($event)">
						<mat-option (click)="settingNew=true">
							<span class="add-option">
								Add Item
								&nbsp;
								<mat-icon>add_box</mat-icon>
							</span>
						</mat-option>
						<mat-option *ngFor="let option of filteredOptions | async" [value]="option">
							{{ option.name }}
						</mat-option>
					</mat-autocomplete>
				</mat-form-field>
			</mat-grid-tile>
	
			<mat-grid-tile colspan="3">
				<mat-form-field appearance="fill">
					<mat-label>Price</mat-label>
					<span matPrefix>$ &nbsp;</span>
					<input matInput formControlName="price" type="number">
				</mat-form-field>
			</mat-grid-tile>

			<mat-grid-tile colspan="4">
				<mat-checkbox color="primary" formControlName="affectsInventory">Affects Inventory</mat-checkbox>
			</mat-grid-tile>
		</mat-grid-list>

		<ng-template [ngIf]="invoiceItemForm.get('affectsInventory').value">
			<div class="info-header">
				<h3>Inventory Info.</h3>
			</div>
			<div formGroupName="inventoryInfo" class="inventory-info">
				<div formArrayName="info">
					<div [formGroupName]="index" class="info-grid" *ngFor="let item of invoiceItemForm.get(['inventoryInfo', 'info'])['controls']; let index = index">
						<mat-grid-list cols="5" gutterSize="20px" rowHeight="75px">
							<mat-grid-tile colspan="3">
								<mat-form-field appearance="fill">
									<mat-label>Product</mat-label>
									<input matInput formControlName="product"/>
								</mat-form-field>
							</mat-grid-tile>
							<mat-grid-tile colspan="2">
								<mat-form-field appearance="fill">
									<mat-label>Quantity</mat-label>
									<input matInput formControlName="quantity"/>
									<span matSuffix>lbs</span>
								</mat-form-field>
							</mat-grid-tile>
						</mat-grid-list>
						<mat-grid-list cols="5" gutterSize="20px" rowHeight="75px">
							<mat-grid-tile colspan="3">
								<mat-form-field appearance="fill">
									<mat-label>Plant</mat-label>
									<input matInput formControlName="plant"/>
								</mat-form-field>
							</mat-grid-tile>
							<mat-grid-tile colspan="2">
								<mat-form-field appearance="fill">
									<mat-label>Tank</mat-label>
									<input matInput formControlName="tank"/>
								</mat-form-field>
							</mat-grid-tile>
						</mat-grid-list>
			
						<mat-divider *ngIf="index !== invoiceItemForm.get(['inventoryInfo', 'info'])['controls'].length - 1"></mat-divider>
					</div>
				</div>
			</div>
		</ng-template>
	</form>
</mat-dialog-content>

<mat-dialog-actions>
	<button mat-button color="primary" [mat-dialog-close]="null">Close</button>
	<button mat-button color="primary" [disabled]="invoiceItemForm.invalid" [mat-dialog-close]="null">Confirm</button>
</mat-dialog-actions>
