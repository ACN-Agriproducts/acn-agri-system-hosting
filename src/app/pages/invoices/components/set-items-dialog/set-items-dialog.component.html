
<h2 mat-dialog-title>Set Invoice Items</h2>

<mat-dialog-content>
	<mat-grid-list cols="10" rowHeight="70px">
		<mat-grid-tile colspan="8">
			<mat-form-field appearance="fill">
				<mat-label>Name</mat-label>

				<ng-container *ngIf="!settingName else setName">
					<input matInput 
						(ngModelChange)="applyFilter($event)"
						[(ngModel)]="currentItem" 
						[matAutocomplete]="auto"
					>

					<mat-autocomplete #auto="matAutocomplete" 
						(optionSelected)="displayInvoiceItem($event)" 
						[displayWith]="displayFn"
					>
						<mat-option (click)="setNew()" [value]="createItem()">
							<span class="add-option">
								Add Item &nbsp; <mat-icon>add_box</mat-icon>
							</span>
						</mat-option>

						<mat-option *ngFor="let option of filteredOptions" [value]="option">{{ option.name }}</mat-option>
					</mat-autocomplete>
				</ng-container>
				<ng-template #setName>
					<input matInput 
						(blur)="settingName = false" 
						(ngModelChange)="applyFilter($event)" 
						[(ngModel)]="currentItem.name"
					>
				</ng-template>

				<span matSuffix class="name-icons">
					<button mat-icon-button *ngIf="currentItem.name !== ''" (click)="reset()">
						<mat-icon>close</mat-icon>
					</button>
					<mat-icon matSuffix>arrow_drop_down</mat-icon>
				</span>
			</mat-form-field>
		</mat-grid-tile>

		<mat-grid-tile colspan="2">
			<ion-button 
				(click)="settingName = !settingName" 
				[color]="settingName ? 'danger': 'primary'" 
				[disabled]="currentItem == null"
				matTooltip="Edit Name"
				matTooltipClass="tooltip-primary-solid" 
				matTooltipPosition="below" 
				matTooltipShowDelay="1000"
			>
				<ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
			</ion-button>
		</mat-grid-tile>

		<mat-grid-tile colspan="5">
			<mat-form-field appearance="fill">
				<mat-label>Price</mat-label>
				<span matPrefix>$ &nbsp;</span>
				<input matInput [(ngModel)]="currentItem.price" type="number">
			</mat-form-field>
		</mat-grid-tile>

		<mat-grid-tile colspan="5">
			<mat-checkbox color="primary" [(ngModel)]="currentItem.affectsInventory">Affects Inventory</mat-checkbox>
		</mat-grid-tile>
	</mat-grid-list>

	<ng-template [ngIf]="currentItem.affectsInventory">
		<div class="info-header">
			Inventory Info
			<button mat-icon-button 
				(click)="currentItem.inventoryInfo.info.unshift(createInfo())"
				matTooltip="Add Inventory Info"
				matTooltipClass="tooltip-primary-solid" 
				matTooltipPosition="left" 
				matTooltipShowDelay="1000"
			>
				<mat-icon>add_box</mat-icon>
			</button>
		</div>

		<div class="inventory-info">
			<div *ngFor="let item of currentItem.inventoryInfo.info; let index = index">
				<mat-divider *ngIf="index !== 0"></mat-divider>

				<div class="info">
					<mat-grid-list cols="10" gutterSize="20px" rowHeight="75px">
						<mat-grid-tile colspan="6">
							<mat-form-field appearance="fill">
								<mat-label>Product</mat-label>
								<mat-select [(ngModel)]="currentItem.inventoryInfo.info[index].product" [disableOptionCentering]="true">
									<mat-option *ngFor="let product of productList" [value]="product">{{ product }}</mat-option>
								</mat-select>
								<mat-error>Product is <strong>required</strong></mat-error>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile colspan="3">
							<mat-form-field appearance="fill">
								<mat-label>Quantity</mat-label>
								<input matInput [(ngModel)]="currentItem.inventoryInfo.info[index].quantity"/>
								<span matSuffix>lbs</span>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile>
							<button mat-icon-button color="warn" (click)="currentItem.inventoryInfo.info.splice(index, 1)">
								<mat-icon>delete</mat-icon>
							</button>
						</mat-grid-tile>
					</mat-grid-list>

					<mat-grid-list cols="10" gutterSize="20px" rowHeight="75px">
						<mat-grid-tile colspan="5">
							<mat-form-field appearance="fill">
								<mat-label>Plant</mat-label>
								<mat-select #plant 
									[(ngModel)]="currentItem.inventoryInfo.info[index].plant"
									[disableOptionCentering]="true" 
								>
									<mat-option *ngFor="let plant of plantList" [value]="plant">{{ plant }}</mat-option>
								</mat-select>
							</mat-form-field>
						</mat-grid-tile>

						<mat-grid-tile colspan="4">
							<mat-form-field appearance="fill">
								<mat-label>Tank</mat-label>
								<mat-select 
									[(ngModel)]="currentItem.inventoryInfo.info[index].tank"
									[disabled]="plant.value == ''" 
									[disableOptionCentering]="true" 
								>
									<mat-option *ngFor="let tank of getTankList(index)" [value]="tank">{{ tank }}</mat-option>
								</mat-select>
							</mat-form-field>
						</mat-grid-tile>
					</mat-grid-list>
				</div>
			</div>
		</div>
	</ng-template>
</mat-dialog-content>

<mat-dialog-actions>
	<button mat-button color="primary" [mat-dialog-close]="null">Cancel</button>
	<button mat-button color="primary" disabled [mat-dialog-close]="null">Confirm</button>
</mat-dialog-actions>
