<ion-header>
  <ion-toolbar>
    <ion-title>Trucker Reports</ion-title>
  </ion-toolbar>
</ion-header>


<ion-content>
  <ion-row>
    <ion-col size="6">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Report Information</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-row>
            <ion-col>
              <mat-form-field>
                <mat-label>Plants</mat-label>
                <mat-select multiple [(ngModel)]="chosenPlants">
                  <mat-option *ngFor="let plant of plantList" [value]="plant">{{plant.ref.id | titlecase}}</mat-option>
                </mat-select>
              </mat-form-field>
            </ion-col>
            <ion-col>
              <mat-form-field>
                <mat-label>Date Range</mat-label>
                <mat-date-range-input [rangePicker]="picker">
                  <input matStartDate placeholder="Start date" [(ngModel)]="startDate">
                  <input matEndDate placeholder="End date" [(ngModel)]="endDate">
                </mat-date-range-input>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
              </mat-form-field>
            </ion-col>
          </ion-row>
          <button mat-button (click)="getTickets()" [disabled]="startDate == null || endDate == null || chosenPlants.length == 0 ">Submit</button>
        </ion-card-content>
      </ion-card>

      <ion-card *ngIf="truckerList">
        <ion-card-header>
          <ion-card-title>Truckers</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-item class="trucker-item" *ngFor="let trucker of truckerList">
            <mat-checkbox (change)="truckerCheckChange($event, trucker)" slot="start"></mat-checkbox>
            {{trucker.name}}
            <div class="freight-input" slot="end">
              <mat-form-field appearance="standard">
                <mat-label>Freight</mat-label>
                <span matPrefix>$</span>
                <input matInput type="number" [(ngModel)]="trucker.freight">
              </mat-form-field>
            </div>
          </ion-item>
          <button mat-button (click)="mergeTruckers()">Merge</button>
          <button mat-button (click)="download()">Download</button>
          <button mat-button
            ngxPrint
            [useExistingCss]="true"
            printSectionId="printable-report"
            [disabled]="ticketsBoxChecked && printableTicketsDone < truckerList.length"
          >Print</button>
          <mat-checkbox (change)="getTruckerPrintableTickets()" [disabled]="ticketsBoxChecked">Print with tickets</mat-checkbox>
          <mat-spinner [diameter]="20" *ngIf="ticketsBoxChecked && printableTicketsDone < truckerList.length"></mat-spinner>
        </ion-card-content>
      </ion-card>
    </ion-col>
    
    <ion-col size="6">
      <mat-card>
        <div id="printable-report">
          <div *ngFor="let trucker of (checkedTruckers || truckerList)">
            <table class="trucker-table" id="{{trucker.name}}">
              <tr>
                <th colspan="6">{{trucker.name}}</th>
              </tr>
              <tr>
                <th>Date</th>
                <th>Id</th>
                <th>Contract</th>
                <th>Net Weight</th>
                <th>Freight</th>
                <th>Total</th>
              </tr>
              <tr *ngFor="let ticket of trucker.tickets">
                <td>{{ticket.dateOut | date: 'shortDate'}}</td>
                <td>{{ticket.id}}</td>
                <td>{{ticket.contractID}}</td>
                <td>{{ticket.getNet()}}</td>
                <td>{{trucker.freight | currency:'USD':'symbol-narrow':'0.3-3'}}</td>
                <td>{{trucker.freight * ticket.getNet() / 100 | currency:'USD':'symbol-narrow':'0.3-3'}}</td> 
              </tr>
              <tr>
                <th colspan="3">Totals</th>
                <th>{{trucker.totalWeight}}</th>
                <th></th>
                <th>{{trucker.freight * trucker.totalWeight / 100  | currency:'USD':'symbol-narrow':'0.3-3'}}</th>
              </tr>
            </table>
            <app-printable-ticket 
              *ngFor="let info of trucker.printableTicketInfo"
              [ticket]="info[0]"
              [contract]="info[1]"
              [transport]="info[2]"
              [client]="info[3]"
              ></app-printable-ticket>
          </div>
        </div>
      </mat-card>
    </ion-col>
  </ion-row>


</ion-content>
